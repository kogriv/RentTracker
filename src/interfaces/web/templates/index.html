{% extends "base.html" %}

{% block title %}–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π - –¢—Ä–µ–∫–µ—Ä –ü–ª–∞—Ç–µ–∂–µ–π –∑–∞ –ì–∞—Ä–∞–∂–∏{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="display-4 mb-3">–¢—Ä–µ–∫–µ—Ä –ü–ª–∞—Ç–µ–∂–µ–π –∑–∞ –ì–∞—Ä–∞–∂–∏</h1>
            <p class="lead text-muted">
                –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –±–∞–Ω–∫–æ–≤—Å–∫–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –æ–∂–∏–¥–∞–µ–º—ã–º–∏ –∞—Ä–µ–Ω–¥–Ω—ã–º–∏ –ø–ª–∞—Ç–µ–∂–∞–º–∏
            </p>
        </div>
    </div>

    <!-- Upload Form -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                    </h5>
                </div>
                <div class="card-body">
                    <form action="{{ url_for('upload_files') }}" method="post" enctype="multipart/form-data" id="uploadForm">
                        
                        <!-- Garage Registry File -->
                        <div class="mb-4">
                            <label for="garage_file" class="form-label">
                                <strong>–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –≥–∞—Ä–∞–∂–µ–π</strong>
                                <span class="text-muted">(Excel —Ñ–∞–π–ª —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≥–∞—Ä–∞–∂–∞—Ö)</span>
                            </label>
                            <div class="upload-area" id="garageUploadArea">
                                <input type="file" class="form-control" id="garage_file" name="garage_file" 
                                       accept=".xlsx,.xls" required style="display: none;">
                                <div class="upload-content">
                                    <i class="bi bi-cloud-upload" style="font-size: 2rem; color: #6c757d;"></i>
                                    <p class="mt-2 mb-0">
                                        –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞
                                    </p>
                                    <small class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx, .xls</small>
                                </div>
                            </div>
                            <div id="garageFileInfo" class="file-info">
                                <span class="file-name"></span>
                                <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="clearFile('garage')">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>

                        <!-- Bank Statement File -->
                        <div class="mb-4">
                            <label for="statement_file" class="form-label">
                                <strong>–ë–∞–Ω–∫–æ–≤—Å–∫–∞—è –≤—ã–ø–∏—Å–∫–∞</strong>
                                <span class="text-muted">(Excel —Ñ–∞–π–ª —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏)</span>
                            </label>
                            <div class="upload-area" id="statementUploadArea">
                                <input type="file" class="form-control" id="statement_file" name="statement_file" 
                                       accept=".xlsx,.xls" required style="display: none;">
                                <div class="upload-content">
                                    <i class="bi bi-cloud-upload" style="font-size: 2rem; color: #6c757d;"></i>
                                    <p class="mt-2 mb-0">
                                        –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Å—é–¥–∞
                                    </p>
                                    <small class="text-muted">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ñ–æ—Ä–º–∞—Ç—ã: .xlsx, .xls</small>
                                </div>
                            </div>
                            <div id="statementFileInfo" class="file-info">
                                <span class="file-name"></span>
                                <button type="button" class="btn btn-sm btn-outline-danger ms-2" onclick="clearFile('statement')">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>

                        <!-- Analysis Date -->
                        <div class="mb-4">
                            <label for="analysis_date" class="form-label">
                                <strong>–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞</strong>
                                <span class="text-muted">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span>
                            </label>
                            <input type="date" class="form-control" id="analysis_date" name="analysis_date" 
                                   value="{{ date.today().strftime('%Y-%m-%d') }}">
                            <div class="form-text">
                                –î–∞—Ç–∞, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–ª–∞—Ç–µ–∂–∏. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–µ–∫—É—â–∞—è –¥–∞—Ç–∞.
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="submitBtn">
                                <span id="submitText">
                                    üöÄ –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø–ª–∞—Ç–µ–∂–∏
                                </span>
                                <span id="loadingText" style="display: none;">
                                    <span class="spinner-border spinner-border-sm me-2"></span>
                                    –û–±—Ä–∞–±–æ—Ç–∫–∞...
                                </span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Information Cards -->
    <div class="row mt-5">
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="text-primary mb-3">
                        <i class="bi bi-upload" style="font-size: 2.5rem;"></i>
                    </div>
                    <h5 class="card-title">–ü—Ä–æ—Å—Ç–∞—è –∑–∞–≥—Ä—É–∑–∫–∞</h5>
                    <p class="card-text text-muted">
                        –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª—ã —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ –≥–∞—Ä–∞–∂–µ–π –∏ –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –≤—ã–ø–∏—Å–∫–∏ –æ–¥–Ω–∏–º –∫–ª–∏–∫–æ–º
                    </p>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="text-success mb-3">
                        <i class="bi bi-gear-fill" style="font-size: 2.5rem;"></i>
                    </div>
                    <h5 class="card-title">–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞</h5>
                    <p class="card-text text-muted">
                        –ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–µ–π —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–æ–≤
                    </p>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 mb-3">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-body text-center">
                    <div class="text-info mb-3">
                        <i class="bi bi-file-earmark-excel" style="font-size: 2.5rem;"></i>
                    </div>
                    <h5 class="card-title">–ü–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á–µ—Ç</h5>
                    <p class="card-text text-muted">
                        –ü–æ–ª—É—á–∏—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π Excel –æ—Ç—á–µ—Ç —Å –∞–Ω–∞–ª–∏–∑–æ–º –ø–ª–∞—Ç–µ–∂–µ–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Features List -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card border-0 bg-light">
                <div class="card-body">
                    <h5 class="card-title text-center mb-4">–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã</h5>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2">‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–µ—Ä–∏–æ–¥–∞ –ø–ª–∞—Ç–µ–∂–µ–π</li>
                                <li class="mb-2">‚úÖ –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π</li>
                                <li class="mb-2">‚úÖ –†–∞—Å—á–µ—Ç –¥–Ω–µ–π –ø—Ä–æ—Å—Ä–æ—á–∫–∏</li>
                                <li class="mb-2">‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ (–ø–æ–ª—É—á–µ–Ω, –ø—Ä–æ—Å—Ä–æ—á–µ–Ω, –æ–∂–∏–¥–∞–µ—Ç—Å—è)</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li class="mb-2">‚úÖ –†—É—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</li>
                                <li class="mb-2">‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —Å–≤–æ–¥–∫–∏</li>
                                <li class="mb-2">‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö —Å—É–º–º</li>
                                <li class="mb-2">‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">

<script>
// File upload handling
function setupFileUpload(uploadAreaId, fileInputId, fileInfoId) {
    const uploadArea = document.getElementById(uploadAreaId);
    const fileInput = document.getElementById(fileInputId);
    const fileInfo = document.getElementById(fileInfoId);
    
    // Click to upload
    uploadArea.addEventListener('click', () => {
        fileInput.click();
    });
    
    // File selection
    fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
            showFileInfo(file, fileInfo, uploadArea);
        }
    });
    
    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', () => {
        uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
        
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                fileInput.files = files;
                showFileInfo(file, fileInfo, uploadArea);
            } else {
                alert('–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ Excel —Ñ–∞–π–ª—ã (.xlsx, .xls)');
            }
        }
    });
}

function showFileInfo(file, fileInfo, uploadArea) {
    const fileName = fileInfo.querySelector('.file-name');
    fileName.textContent = `üìÑ ${file.name} (${formatFileSize(file.size)})`;
    fileInfo.style.display = 'block';
    uploadArea.style.display = 'none';
}

function clearFile(type) {
    const fileInput = document.getElementById(type + '_file');
    const fileInfo = document.getElementById(type + 'FileInfo');
    const uploadArea = document.getElementById(type + 'UploadArea');
    
    fileInput.value = '';
    fileInfo.style.display = 'none';
    uploadArea.style.display = 'block';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

// Form submission
document.getElementById('uploadForm').addEventListener('submit', function() {
    const submitBtn = document.getElementById('submitBtn');
    const submitText = document.getElementById('submitText');
    const loadingText = document.getElementById('loadingText');
    
    submitBtn.disabled = true;
    submitText.style.display = 'none';
    loadingText.style.display = 'inline';
});

// Initialize file upload areas
document.addEventListener('DOMContentLoaded', function() {
    setupFileUpload('garageUploadArea', 'garage_file', 'garageFileInfo');
    setupFileUpload('statementUploadArea', 'statement_file', 'statementFileInfo');
});
</script>
{% endblock %}